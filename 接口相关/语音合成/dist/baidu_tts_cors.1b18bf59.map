{"version":3,"sources":["js\\baidu_tts_cors.js"],"names":["btts","param","options","url","opt","p","audio","document","createElement","autoplay","setAttribute","hidden","style","display","volume","isFunction","onInit","DEFAULT_TIMEOUT","timeout","xhr","XMLHttpRequest","open","data","cuid","tok","ctp","lan","fd","k","push","encodeURIComponent","frd","FileReader","responseType","send","join","console","log","timer","setTimeout","abort","onTimeout","onreadystatechange","readyState","clearTimeout","status","response","type","body","append","URL","createObjectURL","autoDestory","onended","removeChild","onSuccess","onload","text","result","onError","readAsText","obj","Object","prototype","toString","call"],"mappings":"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","file":"baidu_tts_cors.1b18bf59.map","sourceRoot":"..\\src","sourcesContent":["/**\n * 浏览器调用语音合成接口\n * @param {Object} param 百度语音合成接口参数\n * 请参考 https://ai.baidu.com/docs#/TTS-API/41ac79a6\n * @param {Object} options 跨域调用api参数\n *           timeout {number} 超时时间 默认不设置为60秒\n *           volume {number} audio控件音量，范围 0-1\n *           hidden {boolean} 是否隐藏audio控件\n *           autoDestory {boolean} 播放音频完毕后是否自动删除控件\n *           onInit {Function} 创建完audio控件后调用\n *           onSuccess {Function} 远程语音合成完成，并且返回音频文件后调用\n *           onError {Function}  远程语音合成完成，并且返回错误字符串后调用\n *           onTimeout {Function} 超时后调用，默认超时时间为60秒\n */\nfunction btts(param, options) {\n  var url = 'https://tsn.baidu.com/text2audio';\n  var opt = options || {};\n  var p = param || {};\n\n  // 如果浏览器支持，可以设置autoplay，但是不能兼容所有浏览器\n  var audio = document.createElement('audio');\n  if(opt.autoplay) {\n    audio.setAttribute('autoplay', 'autoplay');\n  }\n\n  // 隐藏控制栏\n  if(!opt.hidden) {\n    audio.setAttribute('controls', 'controls');\n  } else {\n    audio.style.display = 'none';\n  }\n\n  // 设置音量\n  if(typeof opt.volume !== 'undefined') {\n    audio.volume = opt.volume;\n  }\n\n  // 调用onInit回调\n  isFunction(opt.onInit) && opt.onInit(audio);\n\n  // 默认超时时间60秒\n  var DEFAULT_TIMEOUT = 60000;\n  var timeout = opt.timeout || DEFAULT_TIMEOUT;\n\n  // 创建XMLHttpRequest对象\n  var xhr = new XMLHttpRequest();\n  xhr.open('POST', url);\n\n  // 创建form参数\n  var data = {};\n  for(var p in param) {\n    data[p] = param[p]\n  }\n\n  // 赋值预定义参数\n  data.cuid = data.cuid || data.tok;\n  data.ctp = 1;\n  data.lan = data.lan || 'zh';\n\n  // 序列化参数列表\n  var fd = [];\n  for(var k in data) {\n    fd.push(k + '=' + encodeURIComponent(data[k]));\n  }\n  \n  // 用来处理blob数据\n  var frd = new FileReader();\n  xhr.responseType = 'blob';\n  xhr.send(fd.join('&'));\n  \n  console.log(fd.join('&'))\n\n  // 用timeout可以更兼容的处理兼容超时\n  var timer = setTimeout(function() {\n    xhr.abort();\n    isFunction(opt.onTimeout) && opt.onTimeout();\n  }, timeout);\n\n  xhr.onreadystatechange = function() {\n    if(xhr.readyState == 4) {\n      clearTimeout(timer);\n      if(xhr.status == 200) {\n        if(xhr.response.type === 'audio/mp3') {\n\n          // 在body元素下apppend音频控件\n          document.body.append(audio);\n\n          audio.setAttribute('src', URL.createObjectURL(xhr.response));\n\n          // autoDestory设置则播放完后移除audio的dom对象\n          if(opt.autoDestory) {\n            audio.onended = function() {\n              document.body.removeChild(audio);\n            }\n          }\n\n          isFunction(opt.onSuccess) && opt.onSuccess(audio);\n        }\n\n        // 用来处理错误\n        if(xhr.response.type === 'application/json') {\n          frd.onload = function() {\n            var text = frd.result;\n            isFunction(opt.onError) && opt.onError(text);\n          };\n          frd.readAsText(xhr.response);\n        }\n      }\n    }\n  }\n\n  // 判断是否是函数\n  function isFunction(obj) {\n    if(Object.prototype.toString.call(obj) === '[object Function]') {\n      return true;\n    }\n    return false;\n  }\n}\n\n//module.exports = btts"]}